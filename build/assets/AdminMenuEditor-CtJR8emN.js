import{ak as z,al as D,b7 as Q,j as e,an as _,ao as x,aE as m,aG as v,b8 as F,b9 as O,ba as J}from"./index-Cjn3py5b.js";import{r,R as U}from"./vendor-BagLKi1z.js";import{F as l,I as k,e as S}from"./index-2ZNh93OQ.js";import{s as c}from"./index-lI4ucwGs.js";import{D as Y}from"./index-BPImXYFt.js";import{C as R}from"./index-7W5owr5O.js";import{S as B,E as Z,R as H,M as V}from"./DeleteOutlined-DhB81-EL.js";import{T as ee}from"./index-C8o8maEZ.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";import"./index-B-P4hzy5.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 00-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 00-11.3 0L405.6 242.3a7.23 7.23 0 005.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 000 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 00.1-11.4z"}}]},name:"drag",theme:"outlined"},te=function(i,d){return r.createElement(z,D({},i,{ref:d,icon:ne}))},re=r.forwardRef(te),le={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},se=function(i,d){return r.createElement(z,D({},i,{ref:d,icon:le}))},I=r.forwardRef(se),ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"}}]},name:"menu",theme:"outlined"},ie=function(i,d){return r.createElement(z,D({},i,{ref:d,icon:ae}))},L=r.forwardRef(ie);const{Title:oe}=_,{Option:ce}=B,ve=()=>{const[a,i]=r.useState([]),[d]=l.useForm(),[A,j]=r.useState(!1),[E,y]=r.useState(null),[f]=l.useForm(),[h,g]=r.useState(null),[w,C]=r.useState(null);r.useEffect(()=>{p()},[]);const p=async()=>{try{const n=await Q();if(n&&n.length>0){const t=n.map((o,b)=>({...o,order:o.order??b}));i(t)}else i([])}catch(n){console.error("Lỗi tải menu:",n),c.error("Không thể tải menu")}},N=n=>{g(n)},$=(n,t)=>{n.preventDefault(),C(t)},X=()=>{C(null)},W=async(n,t)=>{if(n.preventDefault(),C(null),!h||!h.id||!t.id||h.id===t.id){g(null);return}try{const o=a.findIndex(s=>s.id===h.id),b=a.findIndex(s=>s.id===t.id);if(o===-1||b===-1){g(null);return}const u=[...a],[K]=u.splice(o,1);u.splice(b,0,K),u.forEach((s,P)=>{s.order=P}),i(u),g(null);for(let s=0;s<u.length;s++)await O(u[s].id,{order:s});c.success("Cập nhật vị trí menu thành công")}catch(o){console.error("Lỗi cập nhật vị trí:",o),c.error("Cập nhật vị trí thất bại"),g(null),p()}},q=async n=>{try{const t={label:n.label.trim(),href:n.href.trim()};n.parent?await F(t,n.parent):await F(t),c.success("Thêm mục menu thành công"),d.resetFields(),p()}catch(t){console.error("Lỗi thêm menu:",t),c.error(`Lỗi: ${t instanceof Error?t.message:"Lỗi không xác định"}`)}},M=n=>{V.confirm({title:"Xác nhận xóa",content:"Bạn có chắc chắn muốn xóa mục menu này?",okText:"Xóa",cancelText:"Hủy",okType:"danger",onOk:async()=>{try{console.log("[menu] Deleting item:",n),await J(n),console.log("[menu] Item deleted from Firebase"),await new Promise(t=>setTimeout(t,500)),await p(),c.success("Xóa mục menu thành công")}catch(t){console.error("Lỗi xóa menu:",t),c.error("Xóa thất bại");try{await p()}catch(o){console.error("Lỗi reload menu:",o)}}}})},T=n=>{y(n),f.setFieldsValue({label:n.label,href:n.href}),j(!0)},G=async n=>{if(E)try{await O(E.id,{label:n.label,href:n.href}),c.success("Cập nhật mục menu thành công"),j(!1),y(null),f.resetFields(),p()}catch(t){console.error("Lỗi cập nhật menu:",t),c.error("Cập nhật thất bại")}};return e.jsxs("div",{style:{padding:"16px",background:"#f0f2f5",minHeight:"100vh"},children:[e.jsx(oe,{level:3,children:"Quản lý Menu Client"}),e.jsx(Y,{}),e.jsx(R,{title:e.jsxs("span",{children:[e.jsx(S,{})," Thêm mục mới"]}),style:{marginBottom:24},type:"inner",children:e.jsxs(l,{form:d,layout:"inline",onFinish:q,style:{width:"100%"},children:[e.jsx(l.Item,{name:"label",rules:[{required:!0,message:"Vui lòng nhập nhãn"}],style:{flex:1,minWidth:200},children:e.jsx(k,{placeholder:"Nhãn (label)",prefix:e.jsx(L,{}),size:"large"})}),e.jsx(l.Item,{name:"href",rules:[{required:!0,message:"Vui lòng nhập liên kết"}],style:{flex:1,minWidth:200},children:e.jsx(k,{placeholder:"Liên kết (href)",prefix:e.jsx(I,{}),size:"large"})}),e.jsx(l.Item,{name:"parent",style:{minWidth:200},children:e.jsx(B,{placeholder:"-- Top level --",allowClear:!0,size:"large",children:a.map(n=>e.jsx(ce,{value:n.id,children:n.label},n.id))})}),e.jsx(l.Item,{children:e.jsx(x,{type:"primary",htmlType:"submit",icon:e.jsx(S,{}),size:"large",children:"Thêm"})})]})}),e.jsx(R,{title:"Danh sách menu",type:"inner",children:a.length===0?e.jsx(Z,{description:"Chưa có mục menu nào"}):e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",border:"1px solid #d9d9d9"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#fafafa",borderBottom:"1px solid #d9d9d9"},children:[e.jsx("th",{style:{width:30,padding:"8px",textAlign:"center"}}),e.jsx("th",{style:{padding:"8px",textAlign:"left"},children:"Nhãn"}),e.jsx("th",{style:{padding:"8px",textAlign:"left"},children:"Liên kết"}),e.jsx("th",{style:{width:150,padding:"8px",textAlign:"left"},children:"Hành động"})]})}),e.jsx("tbody",{children:a.map(n=>e.jsxs(U.Fragment,{children:[e.jsxs("tr",{draggable:!0,onDragStart:()=>N(n),onDragOver:t=>$(t,n),onDragLeave:X,onDrop:t=>W(t,n),style:{borderBottom:"1px solid #d9d9d9",backgroundColor:(w==null?void 0:w.id)===n.id?"#e6f7ff":"transparent",opacity:(h==null?void 0:h.id)===n.id?.5:1,cursor:"grab",transition:"background-color 0.2s"},children:[e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:e.jsx(re,{style:{color:"#bfbfbf",cursor:"move"}})}),e.jsx("td",{style:{padding:"8px"},children:e.jsxs(m,{children:[e.jsx(L,{style:{color:"#1890ff"}}),e.jsx("span",{style:{fontWeight:600},children:n.label}),n.children&&n.children.length>0&&e.jsxs(ee,{color:"blue",children:[n.children.length," mục con"]})]})}),e.jsx("td",{style:{padding:"8px",color:"#666"},children:e.jsxs(m,{children:[e.jsx(I,{style:{color:"#52c41a"}}),e.jsx("span",{children:n.href})]})}),e.jsx("td",{style:{padding:"8px"},children:e.jsxs(m,{size:"small",children:[e.jsx(x,{type:"link",size:"small",icon:e.jsx(v,{}),onClick:()=>T(n),children:"Sửa"}),e.jsx(x,{type:"link",size:"small",danger:!0,icon:e.jsx(H,{}),onClick:()=>n.id&&M(n.id),children:"Xóa"})]})})]}),n.children&&n.children.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa"},children:[e.jsx("td",{style:{padding:"8px",textAlign:"center",color:"#999"},children:"└─"}),e.jsx("td",{style:{padding:"8px",paddingLeft:"32px"},children:e.jsxs(m,{children:[e.jsx(L,{style:{color:"#999",fontSize:"12px"}}),e.jsx("span",{style:{color:"#666"},children:t.label})]})}),e.jsx("td",{style:{padding:"8px",color:"#999"},children:e.jsxs(m,{children:[e.jsx(I,{style:{color:"#999",fontSize:"12px"}}),e.jsx("span",{children:t.href})]})}),e.jsx("td",{style:{padding:"8px"},children:e.jsxs(m,{size:"small",children:[e.jsx(x,{type:"link",size:"small",icon:e.jsx(v,{}),onClick:()=>T(t),children:"Sửa"}),e.jsx(x,{type:"link",size:"small",danger:!0,icon:e.jsx(H,{}),onClick:()=>t.id&&M(t.id),children:"Xóa"})]})})]},t.id))]},n.id))})]})})}),e.jsx(V,{title:e.jsxs("span",{children:[e.jsx(v,{})," Chỉnh sửa mục menu"]}),open:A,onCancel:()=>{j(!1),y(null),f.resetFields()},footer:null,width:600,children:e.jsxs(l,{form:f,layout:"vertical",onFinish:G,children:[e.jsx(l.Item,{label:"Nhãn",name:"label",rules:[{required:!0,message:"Vui lòng nhập nhãn"}],children:e.jsx(k,{placeholder:"Nhãn (label)",prefix:e.jsx(L,{}),size:"large"})}),e.jsx(l.Item,{label:"Liên kết",name:"href",rules:[{required:!0,message:"Vui lòng nhập liên kết"}],children:e.jsx(k,{placeholder:"Liên kết (href)",prefix:e.jsx(I,{}),size:"large"})}),e.jsx(l.Item,{style:{marginBottom:0,marginTop:24},children:e.jsxs(m,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(x,{onClick:()=>{j(!1),y(null),f.resetFields()},children:"Hủy"}),e.jsx(x,{type:"primary",htmlType:"submit",icon:e.jsx(v,{}),children:"Cập nhật"})]})})]})})]})};export{ve as default};
