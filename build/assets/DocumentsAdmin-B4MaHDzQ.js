import{aL as C,aM as L,aN as S,aO as v,aP as F,j as t,aE as f,ao as x,aG as M}from"./index-Cjn3py5b.js";import{r as o}from"./vendor-BagLKi1z.js";import{D as E,d as A}from"./index-DiSWXAzL.js";import{F as i,I as c,e as P}from"./index-2ZNh93OQ.js";import{s as n}from"./index-lI4ucwGs.js";import{F as R,P as U}from"./Table-DOoVuXeP.js";import{M as B,R as N}from"./DeleteOutlined-DhB81-EL.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";import"./ClockCircleOutlined-CWsPhV0W.js";class O{async getAllDocuments(){return C()}async getDocumentById(s){return L(s)}async createDocument(s){return S(s)}async updateDocument(s,d){return v(s,d)}async deleteDocument(s){return F(s)}}const m=new O,z=()=>{const[y,s]=o.useState([]),[d,u]=o.useState(!1),[r,h]=o.useState(null),[g,D]=o.useState(""),[l]=i.useForm();o.useEffect(()=>{p()},[]);const p=async()=>{try{const e=await m.getAllDocuments();s(e)}catch(e){console.error("Lỗi tải tài liệu:",e),n.error("Không thể tải tài liệu")}},j=()=>{h(null),l.resetFields(),u(!0)},b=e=>{h(e),l.setFieldsValue({title:e.title,description:e.description,category:e.category,publishDate:e.publishDate?A(e.publishDate):void 0,fileUrl:e.fileUrl||""}),u(!0)},w=async e=>{try{await m.deleteDocument(e),n.success("Xóa tài liệu thành công"),p()}catch(a){console.error("Lỗi xóa tài liệu:",a),n.error("Xóa thất bại")}},I=async()=>{try{const e=await l.validateFields(),a={title:e.title,description:e.description||"",category:e.category,publishDate:e.publishDate?e.publishDate.format("YYYY-MM-DD"):"",fileUrl:e.fileUrl||""};r&&r.id?(await m.updateDocument(r.id,{...r,...a}),n.success("Cập nhật tài liệu thành công")):(await m.createDocument(a),n.success("Thêm tài liệu mới thành công")),u(!1),p()}catch(e){console.error("Lỗi lưu tài liệu:",e),n.error(`Lỗi lưu dữ liệu: ${e instanceof Error?e.message:"Lỗi không xác định"}`)}},T=y.filter(e=>e.title.toLowerCase().includes(g.toLowerCase())||e.category.toLowerCase().includes(g.toLowerCase())),k=[{title:"Tiêu đề",dataIndex:"title",key:"title"},{title:"Danh mục",dataIndex:"category",key:"category"},{title:"Ngày phát hành",dataIndex:"publishDate",key:"publishDate",render:e=>e?new Date(e).toLocaleDateString("vi-VN"):""},{title:"Hành động",key:"actions",render:(e,a)=>t.jsxs(f,{children:[t.jsx(x,{icon:t.jsx(M,{}),onClick:()=>b(a)}),t.jsx(U,{title:"Xác nhận xóa?",onConfirm:()=>w(a.id),okText:"Xóa",cancelText:"Hủy",children:t.jsx(x,{danger:!0,icon:t.jsx(N,{})})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx("h2",{children:"Quản lý Tài liệu Pháp luật"}),t.jsxs(f,{children:[t.jsx(c.Search,{placeholder:"Tìm kiếm tài liệu...",onSearch:e=>D(e),onChange:e=>D(e.target.value),style:{width:300},allowClear:!0}),t.jsx(x,{type:"primary",icon:t.jsx(P,{}),onClick:j,children:"Thêm mới"})]})]}),t.jsx(R,{dataSource:T,columns:k,rowKey:e=>e.id,locale:{emptyText:"Không có dữ liệu"}}),t.jsx(B,{title:r?"Chỉnh sửa tài liệu":"Thêm tài liệu mới",open:d,onOk:I,onCancel:()=>{u(!1),l.resetFields(),h(null)},okText:"Lưu",cancelText:"Hủy",children:t.jsxs(i,{form:l,layout:"vertical",children:[t.jsx(i.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề"}],children:t.jsx(c,{})}),t.jsx(i.Item,{name:"description",label:"Mô tả",children:t.jsx(c.TextArea,{rows:3})}),t.jsx(i.Item,{name:"category",label:"Danh mục",rules:[{required:!0,message:"Vui lòng nhập danh mục"}],children:t.jsx(c,{})}),t.jsx(i.Item,{name:"publishDate",label:"Ngày phát hành",children:t.jsx(E,{})}),t.jsx(i.Item,{name:"fileUrl",label:"Link file",children:t.jsx(c,{})})]})})]})};export{z as default};
