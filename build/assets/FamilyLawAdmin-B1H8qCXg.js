var G=Object.defineProperty;var B=(h,n,s)=>n in h?G(h,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):h[n]=s;var v=(h,n,s)=>B(h,typeof n!="symbol"?n+"":n,s);import{bj as T,bk as N,bl as Q,bm as R,j as e,aE as I,ao as b,aG as X}from"./index-Cjn3py5b.js";import{r as p}from"./vendor-BagLKi1z.js";import{F as $}from"./FileUploadCloudinary-BXH5zxUQ.js";import{F as l,I as c,e as z}from"./index-2ZNh93OQ.js";import{s as m}from"./index-lI4ucwGs.js";import{F as K,P as V}from"./Table-DOoVuXeP.js";import{M as O,R as P}from"./DeleteOutlined-DhB81-EL.js";import{T as U}from"./index-B-P4hzy5.js";import{I as _}from"./index-CRVR9_FD.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";class J{constructor(){v(this,"subscribers",[])}initialize(){this.notify()}async getAllFamilyLaws(){return T()}async getFamilyLawById(n){return(await T()).find(o=>o.id===n)}async createFamilyLaw(n){const s=await N(n);return this.notify(),s}async updateFamilyLaw(n,s){try{const o=await Q(n,s);return this.notify(),o}catch{return null}}async deleteFamilyLaw(n){try{return await R(n),this.notify(),!0}catch{return!1}}subscribe(n){return this.subscribers.push(n),()=>{this.subscribers=this.subscribers.filter(s=>s!==n)}}notify(){this.subscribers.forEach(n=>n())}}const w=new J,ce=()=>{const[h,n]=p.useState([]),[s,o]=p.useState(!1),[y,x]=p.useState(null),[S,L]=p.useState(""),[d]=l.useForm();p.useEffect(()=>{f()},[]);const f=async()=>{try{const t=await w.getAllFamilyLaws();n(t)}catch(t){console.error("Lỗi tải family law:",t),m.error("Không thể tải family law")}},k=()=>{x(null),d.resetFields(),o(!0)},q=t=>{var a,u,i;x(t),d.setFieldsValue({question:t.question,shortDescription:t.shortDescription,image:t.image,fullDescription:t.fullDescription||"",overview:t.overview||"",definition:t.definition||"",relatedLaws:((a=t.relatedLaws)==null?void 0:a.join(`
`))||"",processSteps:((u=t.processSteps)==null?void 0:u.map(g=>`${g.title}
${g.description}`).join(`
---
`))||"",tips:((i=t.tips)==null?void 0:i.join(`
`))||""}),o(!0)},C=async t=>{try{await w.deleteFamilyLaw(t)?(m.success("Xóa thành công"),f()):m.error("Xóa thất bại")}catch(a){console.error("Lỗi xóa family law:",a),m.error("Xóa thất bại")}},A=async()=>{var t,a,u;try{const i=await d.validateFields(),g=((t=i.processSteps)==null?void 0:t.split("---").filter(r=>r.trim()).map(r=>{const[j,...M]=r.trim().split(`
`);return{title:(j==null?void 0:j.trim())||"",description:M.join(`
`).trim()||""}}))||[],F={question:i.question,shortDescription:i.shortDescription||"",image:i.image||"",fullDescription:i.fullDescription||"",overview:i.overview||"",definition:i.definition||"",relatedLaws:((a=i.relatedLaws)==null?void 0:a.split(`
`).filter(r=>r.trim()).map(r=>r.trim()))||[],processSteps:g,tips:((u=i.tips)==null?void 0:u.split(`
`).filter(r=>r.trim()).map(r=>r.trim()))||[]};y&&y.id?(await w.updateFamilyLaw(y.id,F),m.success("Cập nhật thành công")):(await w.createFamilyLaw(F),m.success("Thêm mới thành công")),o(!1),f()}catch(i){console.error("Lỗi lưu family law:",i),m.error(`Lỗi lưu dữ liệu: ${i instanceof Error?i.message:"Lỗi không xác định"}`)}},D=h.filter(t=>t.question.toLowerCase().includes(S.toLowerCase())),H=[{title:"Câu hỏi",dataIndex:"question",key:"question",width:"40%"},{title:"Mô tả ngắn",dataIndex:"shortDescription",key:"shortDescription",width:"35%",render:t=>(t==null?void 0:t.substring(0,50))+"..."},{title:"Hình ảnh",dataIndex:"image",key:"image",width:"15%",render:t=>t?e.jsx(_,{src:t,alt:"thumb",width:80}):"-"},{title:"Hành động",key:"actions",width:"10%",render:(t,a)=>e.jsxs(I,{children:[e.jsx(b,{size:"small",icon:e.jsx(X,{}),onClick:()=>q(a)}),e.jsx(V,{title:"Xác nhận xóa?",onConfirm:()=>C(a.id),okText:"Xóa",cancelText:"Hủy",children:e.jsx(b,{danger:!0,size:"small",icon:e.jsx(P,{})})})]})}],E=[{key:"1",label:"Thông tin cơ bản",children:e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"question",label:"Câu hỏi *",rules:[{required:!0,message:"Vui lòng nhập câu hỏi"}],children:e.jsx(c,{placeholder:"VD: Thủ tục ly hôn như thế nào?"})}),e.jsx(l.Item,{name:"shortDescription",label:"Mô tả ngắn *",rules:[{required:!0,message:"Vui lòng nhập mô tả ngắn"}],children:e.jsx(c.TextArea,{rows:3,placeholder:"Mô tả ngắn gọn về câu hỏi"})}),e.jsx(l.Item,{name:"image",label:"Hình ảnh",children:e.jsx($,{folder:"family-law"})})]})},{key:"2",label:"Nội dung chi tiết",children:e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"overview",label:"Tổng quan vấn đề",children:e.jsx(c.TextArea,{rows:4,placeholder:"Giải thích tổng quát về vấn đề"})}),e.jsx(l.Item,{name:"definition",label:"Khái niệm & định nghĩa",children:e.jsx(c.TextArea,{rows:4,placeholder:"Định nghĩa pháp lý chi tiết"})}),e.jsx(l.Item,{name:"relatedLaws",label:"Quy định pháp luật liên quan (mỗi dòng 1 quy định)",children:e.jsx(c.TextArea,{rows:4,placeholder:`Bộ Luật Dân sự năm 2015
Luật Hôn nhân và Gia đình năm 2000
Các quyết định hướng dẫn của Tòa án Tối cao`})})]})},{key:"3",label:"Hướng dẫn & Lời khuyên",children:e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"processSteps",label:"Hướng dẫn từng bước (ngăn cách mỗi bước bằng ---)",children:e.jsx(c.TextArea,{rows:6,placeholder:`Bước 1: Chuẩn bị giấy tờ
Chuẩn bị đầy đủ các chứng chỉ, hợp đồng...
---
Bước 2: Tư vấn với luật sư
Gặp luật sư để được tư vấn cụ thể...`})}),e.jsx(l.Item,{name:"tips",label:"Lưu ý quan trọng (mỗi dòng 1 lưu ý)",children:e.jsx(c.TextArea,{rows:4,placeholder:`Chuẩn bị đầy đủ giấy tờ trước khi làm thủ tục
Liên hệ cơ quan có thẩm quyền để xác nhận
Se hết, hãy lưu giữ tất cả chứng chỉ`})}),e.jsx(l.Item,{name:"fullDescription",label:"Nội dung chi tiết (tổng hợp)",children:e.jsx(c.TextArea,{rows:8,placeholder:"Nội dung chi tiết full mô tả (nếu muốn hiển thị tất cả nội dung trong 1 trường)"})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"Quản Lý Hôn Nhân - Gia Đình"}),e.jsxs(I,{children:[e.jsx(c.Search,{placeholder:"Tìm kiếm...",onSearch:t=>L(t),onChange:t=>L(t.target.value),style:{width:300},allowClear:!0}),e.jsx(b,{type:"primary",icon:e.jsx(z,{}),onClick:k,children:"Thêm mới"})]})]}),e.jsx(K,{dataSource:D,columns:H,rowKey:t=>t.id,locale:{emptyText:"Không có dữ liệu"},pagination:{pageSize:10}}),e.jsx(O,{title:y?"Chỉnh sửa: Hôn Nhân - Gia Đình":"Thêm mới: Hôn Nhân - Gia Đình",open:s,onOk:A,onCancel:()=>{o(!1),d.resetFields(),x(null)},okText:"Lưu",cancelText:"Hủy",width:900,children:e.jsx(l,{form:d,layout:"vertical",children:e.jsx(U,{items:E})})})]})};export{ce as default};
