var G=Object.defineProperty;var U=(h,s,r)=>s in h?G(h,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):h[s]=r;var F=(h,s,r)=>U(h,typeof s!="symbol"?s+"":s,r);import{bf as V,bg as _,bh as J,bi as W,j as t,aE as M,ao as b,aG as Y}from"./index-Cjn3py5b.js";import{r as i}from"./vendor-BagLKi1z.js";import{F as n,I as c,e as Z}from"./index-2ZNh93OQ.js";import{s as d}from"./index-lI4ucwGs.js";import{F as ee,P as te}from"./Table-DOoVuXeP.js";import{M as se,R as re}from"./DeleteOutlined-DhB81-EL.js";import{I as ie}from"./index-CRVR9_FD.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";class ae{constructor(){F(this,"subscribers",[])}initialize(){this.notify()}async getAllServiceAreas(){return V()}async getServiceAreaById(s){return(await V()).find(o=>o.id===s)}async createServiceArea(s){const r=await _(s);return this.notify(),r}async updateServiceArea(s,r){try{const o=await J(s,r);return this.notify(),o}catch{return null}}async deleteServiceArea(s){try{return await W(s),this.notify(),!0}catch{return!1}}subscribe(s){return this.subscribers.push(s),()=>{this.subscribers=this.subscribers.filter(r=>r!==s)}}notify(){this.subscribers.forEach(s=>s())}}const x=new ae,fe=()=>{const[h,s]=i.useState([]),[r,o]=i.useState(!1),[u,f]=i.useState(null),[D,A]=i.useState(""),[m]=n.useForm(),[C,g]=i.useState(""),[w,v]=i.useState(""),[I,p]=i.useState(""),[L,j]=i.useState(""),[k,S]=i.useState(""),[E,y]=i.useState("");i.useEffect(()=>{T()},[]);const T=async()=>{try{const e=await x.getAllServiceAreas();s(e)}catch(e){console.error("Lỗi tải service areas:",e),d.error("Không thể tải service areas")}},O=()=>{f(null),m.resetFields(),g(""),v(""),p(""),j(""),S(""),y(""),o(!0)},R=e=>{f(e),m.setFieldsValue({title:e.title,description:e.description,image:e.image}),g((e.details||[]).join(`
`)),v((e.benefits||[]).join(`
`)),e.servicesOffered?p(e.servicesOffered.map(a=>`${a.title}|${a.description||""}`).join(`
`)):p(""),j((e.processSteps||[]).join(`
`)),S(e.contactCTA&&e.contactCTA.phone||""),y(e.contactCTA&&e.contactCTA.email||""),o(!0)},P=async e=>{try{await x.deleteServiceArea(e)?(d.success("Xóa thành công"),T()):d.error("Xóa thất bại")}catch(a){console.error("Lỗi xóa service area:",a),d.error("Xóa thất bại")}},X=async()=>{try{const e=await m.validateFields(),a=C.split(`
`).map(l=>l.trim()).filter(Boolean),K=w.split(`
`).map(l=>l.trim()).filter(Boolean),N=I.split(`
`).map(l=>l.trim()).filter(Boolean).map(l=>{const[q,z]=l.split("|");return{title:(q||"").trim(),description:(z||"").trim()}}),Q=L.split(`
`).map(l=>l.trim()).filter(Boolean),B={title:e.title,description:e.description||"",image:e.image||"",details:a,benefits:K,servicesOffered:N,processSteps:Q,contactCTA:{phone:k||"",email:E||""}};u&&u.id?(await x.updateServiceArea(u.id,B),d.success("Cập nhật thành công")):(await x.createServiceArea(B),d.success("Thêm mới thành công")),o(!1),T()}catch(e){console.error("Lỗi lưu service area:",e),d.error(`Lỗi lưu dữ liệu: ${e instanceof Error?e.message:"Lỗi không xác định"}`)}},$=h.filter(e=>(e.title||"").toLowerCase().includes((D||"").toLowerCase())),H=[{title:"Tiêu đề",dataIndex:"title",key:"title"},{title:"Mô tả",dataIndex:"description",key:"description"},{title:"Hình ảnh",dataIndex:"image",key:"image",render:e=>e?t.jsx(ie,{src:e,alt:"thumb",width:80}):null},{title:"Hành động",key:"actions",render:(e,a)=>t.jsxs(M,{children:[t.jsx(b,{icon:t.jsx(Y,{}),onClick:()=>R(a)}),t.jsx(te,{title:"Xác nhận xóa?",onConfirm:()=>P(a.id),okText:"Xóa",cancelText:"Hủy",children:t.jsx(b,{danger:!0,icon:t.jsx(re,{})})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx("h2",{children:"Quản Lý Lĩnh Vực Dịch Vụ"}),t.jsxs(M,{children:[t.jsx(c.Search,{placeholder:"Tìm kiếm...",onSearch:e=>A(e),onChange:e=>A(e.target.value),style:{width:300},allowClear:!0}),t.jsx(b,{type:"primary",icon:t.jsx(Z,{}),onClick:O,children:"Thêm mới"})]})]}),t.jsx(ee,{dataSource:$,columns:H,rowKey:e=>e.id,locale:{emptyText:"Không có dữ liệu"}}),t.jsx(se,{title:u?"Sửa Lĩnh Vực Dịch Vụ":"Thêm Lĩnh Vực Dịch Vụ",open:r,onOk:X,onCancel:()=>{o(!1),m.resetFields(),f(null)},okText:"Lưu",cancelText:"Hủy",width:700,children:t.jsxs(n,{form:m,layout:"vertical",children:[t.jsx(n.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề"}],children:t.jsx(c,{})}),t.jsx(n.Item,{name:"description",label:"Mô tả",children:t.jsx(c,{})}),t.jsx(n.Item,{name:"image",label:"URL hình ảnh",children:t.jsx(c,{})}),t.jsx(n.Item,{label:"Chi tiết (mỗi dòng 1 mục)",children:t.jsx(c.TextArea,{rows:3,value:C,onChange:e=>g(e.target.value),placeholder:"Nhập mỗi chi tiết trên một dòng"})}),t.jsx(n.Item,{label:"Lợi ích (mỗi dòng 1 mục)",children:t.jsx(c.TextArea,{rows:3,value:w,onChange:e=>v(e.target.value),placeholder:"Nhập mỗi lợi ích trên một dòng"})}),t.jsx(n.Item,{label:"Dịch vụ chính (mỗi dòng: Tiêu đề|Mô tả)",children:t.jsx(c.TextArea,{rows:4,value:I,onChange:e=>p(e.target.value),placeholder:"Ví dụ: Tư vấn|Tư vấn chi tiết..."})}),t.jsx(n.Item,{label:"Quy trình (mỗi dòng 1 bước)",children:t.jsx(c.TextArea,{rows:3,value:L,onChange:e=>j(e.target.value),placeholder:"Nhập mỗi bước trên một dòng"})}),t.jsxs(n.Item,{label:"Liên hệ (sẽ hiển thị ở CTA)",children:[t.jsx(c,{placeholder:"Số điện thoại",value:k,onChange:e=>S(e.target.value),style:{marginBottom:8}}),t.jsx(c,{placeholder:"Email",value:E,onChange:e=>y(e.target.value)})]})]})})]})};export{fe as default};
