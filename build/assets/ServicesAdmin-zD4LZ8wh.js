import{aH as F,aI as K,aJ as P,aK as R,j as e,aE as k,ao as w,aG as V}from"./index-Cjn3py5b.js";import{r as c}from"./vendor-BagLKi1z.js";import{F as x,I as S,e as D}from"./index-2ZNh93OQ.js";import{M as O,R as B}from"./DeleteOutlined-DhB81-EL.js";import{T as M}from"./index-C8o8maEZ.js";import{s as v}from"./index-lI4ucwGs.js";import{C as q}from"./index-7W5owr5O.js";import{F as H,P as N}from"./Table-DOoVuXeP.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";import"./index-B-P4hzy5.js";class X{async getAllServices(){return F()}async getServiceById(r){return(await F()).find(n=>n.id===r)||null}async createService(r){return K(r)}async updateService(r,o){return P(r,o)}async deleteService(r){return R(r)}}const b=new X,_=({isOpen:f,onClose:r,onSave:o,editService:n})=>{const[d]=x.useForm(),[h,l]=c.useState([]),[g,j]=c.useState(""),[I,m]=c.useState([]),[u,C]=c.useState(""),[y,T]=c.useState(!1);c.useEffect(()=>{n?(d.setFieldsValue({title:n.title,description:n.description,icon:n.icon}),l(n.details||[]),m(n.benefits||[])):(d.resetFields(),l([]),m([]))},[n,f,d]);const t=()=>{g.trim()&&(l(s=>[...s,g.trim()]),j(""))},i=s=>l(a=>a.filter((E,L)=>L!==s)),p=async()=>{try{const s=await d.validateFields();if(!s.title||!s.description||!s.icon){v.error("Vui lòng điền đầy đủ thông tin!");return}T(!0);const a={...s,details:h,benefits:I};n?await o({...a,id:n.id}):await o(a),r()}catch{}finally{T(!1)}};return e.jsx(O,{title:n?"Chỉnh sửa dịch vụ":"Thêm dịch vụ mới",open:f,onCancel:r,onOk:p,okText:n?"Cập nhật":"Thêm mới",confirmLoading:y,okButtonProps:{disabled:y},cancelButtonProps:{disabled:y},children:e.jsxs(x,{form:d,layout:"vertical",children:[e.jsx(x.Item,{name:"title",label:"Tên dịch vụ",rules:[{required:!0,message:"Vui lòng nhập tên dịch vụ"}],children:e.jsx(S,{placeholder:"Ví dụ: Công chứng hợp đồng"})}),e.jsx(x.Item,{name:"description",label:"Mô tả",rules:[{required:!0,message:"Vui lòng nhập mô tả"}],children:e.jsx(S.TextArea,{rows:4})}),e.jsx(x.Item,{name:"icon",label:"Icon (React Icons)",children:e.jsx(S,{placeholder:"Ví dụ: FaFileContract"})}),e.jsxs(x.Item,{label:"Chi tiết dịch vụ",children:[e.jsxs(k,{style:{marginBottom:8},children:[e.jsx(S,{value:g,onChange:s=>j(s.target.value),onPressEnter:s=>{s.preventDefault(),t()},placeholder:"Nhập chi tiết và nhấn Enter"}),e.jsx(w,{onClick:t,children:"Thêm"})]}),e.jsx("div",{children:h.map((s,a)=>e.jsx(M,{closable:!0,onClose:()=>i(a),style:{marginBottom:8},icon:e.jsx(B,{}),children:s},a))})]}),e.jsxs(x.Item,{label:"Lợi ích (Mỗi lợi ích nhấn Enter)",children:[e.jsxs(k,{style:{marginBottom:8},children:[e.jsx(S,{value:u,onChange:s=>C(s.target.value),onPressEnter:s=>{s.preventDefault(),u.trim()&&(m(a=>[...a,u.trim()]),C(""))},placeholder:"Nhập lợi ích và nhấn Enter"}),e.jsx(w,{onClick:()=>{u.trim()&&(m(s=>[...s,u.trim()]),C(""))},children:"Thêm"})]}),e.jsx("div",{children:I.map((s,a)=>e.jsx(M,{closable:!0,onClose:()=>m(E=>E.filter((L,A)=>A!==a)),style:{marginBottom:8},icon:e.jsx(B,{}),children:s},a))})]})]})})},{Search:$}=S;function ne(){const[f,r]=c.useState([]),[o,n]=c.useState(!1),[d,h]=c.useState(null),[l,g]=c.useState("");c.useEffect(()=>{j()},[]);const j=async()=>{try{const t=await b.getAllServices();r(t)}catch(t){console.error("Lỗi tải dịch vụ:",t),v.error("Không thể tải dịch vụ")}},I=()=>{h(null),n(!0)},m=t=>{h(t),n(!0)},u=async t=>{try{if("id"in t){const i=await b.updateService(t.id,t);i&&(r(p=>p.map(s=>s.id===t.id?i:s)),v.success("Cập nhật dịch vụ thành công!"))}else{const i=await b.createService(t);r(p=>[i,...p]),v.success("Thêm dịch vụ mới thành công!")}n(!1),h(null),await j()}catch(i){console.error("Lỗi lưu dịch vụ:",i),v.error("Không thể lưu dịch vụ")}},C=async t=>{try{await b.deleteService(t),r(i=>i.filter(p=>p.id!==t)),v.success("Xóa dịch vụ thành công!"),await j()}catch(i){console.error("Lỗi xóa dịch vụ:",i),v.error("Xóa thất bại")}},y=f.filter(t=>t.title.toLowerCase().includes(l.toLowerCase())||t.description.toLowerCase().includes(l.toLowerCase())),T=[{title:"Tên dịch vụ",dataIndex:"title",key:"title"},{title:"Mô tả",dataIndex:"description",key:"description",render:t=>t.slice(0,120)+(t.length>120?"...":"")},{title:"Chi tiết (số)",dataIndex:"details",key:"details",render:t=>t?t.length:0},{title:"Hành động",key:"actions",render:(t,i)=>e.jsxs(k,{children:[e.jsx(w,{icon:e.jsx(V,{}),onClick:()=>m(i)}),e.jsx(N,{title:"Bạn có chắc muốn xóa?",onConfirm:()=>C(i.id),okText:"Xóa",cancelText:"Hủy",children:e.jsx(w,{danger:!0,icon:e.jsx(B,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"Quản lý Dịch vụ"}),e.jsxs(k,{children:[e.jsx($,{placeholder:"Tìm kiếm dịch vụ...",onSearch:t=>g(t),onChange:t=>g(t.target.value),style:{width:320},allowClear:!0}),e.jsx(w,{type:"primary",icon:e.jsx(D,{}),onClick:I,children:"Thêm mới"})]})]}),e.jsxs(q,{children:[e.jsx(H,{dataSource:y,columns:T,rowKey:"id",locale:{emptyText:l?"Không tìm thấy dịch vụ phù hợp":"Chưa có dịch vụ nào"}}),e.jsxs("div",{style:{marginTop:16,color:"#6b7280"},children:["Tổng số dịch vụ: ",e.jsx("strong",{children:f.length}),l&&` | Kết quả tìm kiếm: ${y.length}`]})]}),e.jsx(_,{isOpen:o,onClose:()=>{n(!1),h(null)},onSave:u,editService:d})]})}export{ne as default};
