var F=Object.defineProperty;var L=(r,s,i)=>s in r?F(r,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[s]=i;var b=(r,s,i)=>L(r,typeof s!="symbol"?s+"":s,i);import{bb as S,bc as E,bd as K,be as A,j as e,aE as g,ao as y,aG as B}from"./index-Cjn3py5b.js";import{r as u}from"./vendor-BagLKi1z.js";import{F as l,I as h,e as H}from"./index-2ZNh93OQ.js";import{s as c}from"./index-lI4ucwGs.js";import{F as M,P as R}from"./Table-DOoVuXeP.js";import{M as X,R as G}from"./DeleteOutlined-DhB81-EL.js";import{T as O}from"./index-Djy9bll3.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";class V{constructor(){b(this,"subscribers",[])}initialize(){this.notify()}async getAllStatistics(){return S()}async getStatisticById(s){return(await S()).find(a=>a.id===s)}async createStatistic(s){const i=await E(s);return this.notify(),i}async updateStatistic(s,i){try{const a=await K(s,i);return this.notify(),a}catch{return null}}async deleteStatistic(s){try{return await A(s),this.notify(),!0}catch{return!1}}subscribe(s){return this.subscribers.push(s),()=>{this.subscribers=this.subscribers.filter(i=>i!==s)}}notify(){this.subscribers.forEach(s=>s())}}const m=new V,W=()=>{const[r,s]=u.useState([]),[i,a]=u.useState(!1),[d,f]=u.useState(null),[j,p]=u.useState(""),[o]=l.useForm();u.useEffect(()=>{x()},[]);const x=async()=>{try{const t=await m.getAllStatistics();s(t)}catch(t){console.error("Lỗi tải statistics:",t),c.error("Không thể tải statistics")}},T=()=>{f(null),o.resetFields(),a(!0)},w=t=>{f(t),o.setFieldsValue({label:t.label,value:t.value,suffix:t.suffix,icon:t.icon}),a(!0)},I=async t=>{try{await m.deleteStatistic(t)?(c.success("Xóa thành công"),x()):c.error("Xóa thất bại")}catch(n){console.error("Lỗi xóa statistics:",n),c.error("Xóa thất bại")}},v=async()=>{try{const t=await o.validateFields(),n={label:t.label,value:t.value,suffix:t.suffix||"",icon:t.icon||""};d&&d.id?(await m.updateStatistic(d.id,n),c.success("Cập nhật thành công")):(await m.createStatistic(n),c.success("Thêm mới thành công")),a(!1),x()}catch(t){console.error("Lỗi lưu statistics:",t),c.error(`Lỗi lưu dữ liệu: ${t instanceof Error?t.message:"Lỗi không xác định"}`)}},k=r.filter(t=>t.label.toLowerCase().includes(j.toLowerCase())),C=[{title:"Tiêu đề",dataIndex:"label",key:"label"},{title:"Giá trị",dataIndex:"value",key:"value"},{title:"Hậu tố",dataIndex:"suffix",key:"suffix"},{title:"Biểu tượng",dataIndex:"icon",key:"icon"},{title:"Hành động",key:"actions",render:(t,n)=>e.jsxs(g,{children:[e.jsx(y,{icon:e.jsx(B,{}),onClick:()=>w(n)}),e.jsx(R,{title:"Xác nhận xóa?",onConfirm:()=>I(n.id),okText:"Xóa",cancelText:"Hủy",children:e.jsx(y,{danger:!0,icon:e.jsx(G,{})})})]})}];return e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"Quản Lý Thống Kê"}),e.jsxs(g,{children:[e.jsx(h.Search,{placeholder:"Tìm kiếm...",onSearch:t=>p(t),onChange:t=>p(t.target.value),style:{width:300},allowClear:!0}),e.jsx(y,{type:"primary",icon:e.jsx(H,{}),onClick:T,children:"Thêm mới"})]})]}),e.jsx(M,{dataSource:k,columns:C,rowKey:t=>t.id,locale:{emptyText:"Không có dữ liệu"}}),e.jsx(X,{title:d?"Sửa Thống Kê":"Thêm Thống Kê",open:i,onOk:v,onCancel:()=>{a(!1),o.resetFields(),f(null)},okText:"Lưu",cancelText:"Hủy",children:e.jsxs(l,{form:o,layout:"vertical",children:[e.jsx(l.Item,{name:"label",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề"}],children:e.jsx(h,{})}),e.jsx(l.Item,{name:"value",label:"Giá trị",rules:[{required:!0,message:"Vui lòng nhập giá trị"}],children:e.jsx(O,{style:{width:"100%"}})}),e.jsx(l.Item,{name:"suffix",label:"Hậu tố",children:e.jsx(h,{})}),e.jsx(l.Item,{name:"icon",label:"Biểu tượng",children:e.jsx(h,{})})]})})]})};export{W as default};
