import{W as d,j as t,aE as T,ao as j,aG as B}from"./index-Cjn3py5b.js";import{r as i}from"./vendor-BagLKi1z.js";import{F as A}from"./FileUploadCloudinary-BXH5zxUQ.js";import{F as s,I as a,e as E}from"./index-2ZNh93OQ.js";import{s as l}from"./index-lI4ucwGs.js";import{C as D}from"./index-7W5owr5O.js";import{F as H,P as R}from"./Table-DOoVuXeP.js";import{M as P,R as K}from"./DeleteOutlined-DhB81-EL.js";import"./icons-X9-Iq-vF.js";import"./notifications-DStr16IZ.js";import"./index-CRVR9_FD.js";import"./index-B-P4hzy5.js";const{Search:X}=a,te=()=>{const[w,V]=i.useState([]),[y,C]=i.useState(""),[I,o]=i.useState(!1),[c,h]=i.useState(null),[r]=s.useForm(),[O,v]=i.useState(!1),[m,u]=i.useState([]),[g,p]=i.useState([]),[x,b]=i.useState([]);i.useEffect(()=>{f()},[]);const f=async()=>{try{v(!0);const e=await d.getAllVibans();V(e)}catch(e){console.error("Lỗi tải vi bằng:",e),l.error("Không thể tải dữ liệu vi bằng")}finally{v(!1)}},S=()=>{h(null),r.resetFields(),u([]),p([]),b([]),o(!0)},L=e=>{h(e),r.setFieldsValue({title:e.title,description:e.description,fees:e.fees,image:e.image}),u(e.requirements||[]),p(e.process||[]),b(e.benefits||[]),o(!0)},k=async e=>{if(e)try{await d.deleteViban(e),l.success("Xóa vi bằng thành công"),f()}catch(n){console.error("Lỗi xóa vi bằng:",n),l.error("Xóa thất bại")}},F=async()=>{try{const e=await r.validateFields(),n={title:e.title,description:e.description,fees:e.fees,image:e.image||"",requirements:m,process:g,benefits:x};c&&c.id?(await d.updateViban(c.id,n),l.success("Cập nhật vi bằng thành công")):(await d.createViban(n),l.success("Thêm vi bằng mới thành công")),o(!1),r.resetFields(),h(null),f()}catch(e){console.error("Lỗi lưu vi bằng:",e),l.error(`Lỗi lưu dữ liệu: ${e instanceof Error?e.message:"Lỗi không xác định"}`)}},M=w.filter(e=>(e.title||"").toLowerCase().includes(y.toLowerCase())||(e.description||"").toLowerCase().includes(y.toLowerCase())),q=[{title:"Tên",dataIndex:"title",key:"title"},{title:"Mô tả",dataIndex:"description",key:"description",render:e=>e?e.length>120?e.slice(0,120)+"...":e:""},{title:"Phí",dataIndex:"fees",key:"fees"},{title:"Hành động",key:"actions",render:(e,n)=>t.jsxs(T,{children:[t.jsx(j,{icon:t.jsx(B,{}),onClick:()=>L(n)}),t.jsx(R,{title:"Bạn có chắc muốn xóa?",onConfirm:()=>k(n.id),okText:"Xóa",cancelText:"Hủy",children:t.jsx(j,{danger:!0,icon:t.jsx(K,{})})})]})}];return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[t.jsx("h2",{children:"Quản lý Vi bằng (Lập Công Chứng)"}),t.jsxs(T,{children:[t.jsx(X,{placeholder:"Tìm kiếm vi bằng...",onSearch:e=>C(e),onChange:e=>C(e.target.value),style:{width:320},allowClear:!0}),t.jsx(j,{type:"primary",icon:t.jsx(E,{}),onClick:S,children:"Thêm mới"})]})]}),t.jsx(D,{children:t.jsx(H,{dataSource:M,columns:q,rowKey:e=>e.id,locale:{emptyText:"Không có dữ liệu"}})}),t.jsx(P,{title:c?"Chỉnh sửa Vi bằng":"Thêm Vi bằng",open:I,onOk:F,onCancel:()=>{o(!1),r.resetFields(),h(null)},okText:"Lưu",cancelText:"Hủy",width:700,children:t.jsxs(s,{form:r,layout:"vertical",children:[t.jsx(s.Item,{name:"title",label:"Tiêu đề",rules:[{required:!0,message:"Vui lòng nhập tiêu đề"}],children:t.jsx(a,{placeholder:"VD: Vi bằng Dân sự, Vi bằng Hợp đồng Mua bán Bất động sản"})}),t.jsx(s.Item,{name:"description",label:"Mô tả chi tiết",rules:[{required:!0,message:"Vui lòng nhập mô tả"}],children:t.jsx(a.TextArea,{rows:3,placeholder:"Mô tả chi tiết về loại vi bằng này"})}),t.jsx(s.Item,{name:"fees",label:"Phí cấp vi bằng",rules:[{required:!0,message:"Vui lòng nhập phí"}],children:t.jsx(a,{placeholder:"VD: 200.000đ - 500.000đ"})}),t.jsx(s.Item,{name:"image",label:"Hình ảnh",children:t.jsx(A,{folder:"viban"})}),t.jsx(s.Item,{label:"Yêu cầu (mỗi dòng một yêu cầu)",children:t.jsx(a.TextArea,{rows:4,value:m.join(`
`),onChange:e=>u(e.target.value.split(`
`).map(n=>n.trim()).filter(Boolean)),placeholder:`Giấy CMND/CCCD của các bên liên quan
Chứng chỉ khai sinh
Hóa đơn điện, nước`})}),t.jsx(s.Item,{label:"Quy trình (mỗi dòng một bước)",children:t.jsx(a.TextArea,{rows:4,value:g.join(`
`),onChange:e=>p(e.target.value.split(`
`).map(n=>n.trim()).filter(Boolean)),placeholder:`Nộp hồ sơ đầy đủ tại cơ quan thừa phát lại
Kiểm tra và làm rõ thông tin
Tiếp xúc xác nhận ý nguyện các bên
Cấp vi bằng`})}),t.jsx(s.Item,{label:"Lợi ích (mỗi dòng một lợi ích)",children:t.jsx(a.TextArea,{rows:3,value:x.join(`
`),onChange:e=>b(e.target.value.split(`
`).map(n=>n.trim()).filter(Boolean)),placeholder:`Xác thực pháp lý
Tiết kiệm thời gian
Bảo vệ quyền lợi`})}),t.jsx("div",{style:{marginTop:16,color:"#666"},children:t.jsxs("p",{children:[t.jsx("strong",{children:"Yêu cầu:"})," ",m.length," mục | ",t.jsx("strong",{children:"Quy trình:"})," ",g.length," bước | ",t.jsx("strong",{children:"Lợi ích:"})," ",x.length," mục"]})})]})})]})};export{te as default};
